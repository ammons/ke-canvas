// stats.js - http://github.com/mrdoob/stats.js
var Stats = function() {var l = Date.now(), m = l, g = 0, n = Infinity, o = 0, h = 0, p = Infinity, q = 0, r = 0, s = 0, f = document.createElement("div");f.id = "stats";f.addEventListener("mousedown", function(b) {b.preventDefault();t(++s%2)}, !1);f.style.cssText = "width:80px;opacity:0.9;cursor:pointer";var a = document.createElement("div");a.id = "fps";a.style.cssText = "padding:0 0 3px 3px;text-align:left;background-color:#002";f.appendChild(a);var i = document.createElement("div");i.id = "fpsText";i.style.cssText = "color:#0ff;font-family:Helvetica,Arial,sans-serif;font-size:9px;font-weight:bold;line-height:15px";i.innerHTML = "FPS";a.appendChild(i);var c = document.createElement("div");c.id = "fpsGraph";c.style.cssText = "position:relative;width:74px;height:30px;background-color:#0ff";for (a.appendChild(c); 74 > c.children.length;) {var j = document.createElement("span");j.style.cssText = "width:1px;height:30px;float:left;background-color:#113";c.appendChild(j)}var d = document.createElement("div");d.id = "ms";d.style.cssText = "padding:0 0 3px 3px;text-align:left;background-color:#020;display:none";f.appendChild(d);var k = document.createElement("div");k.id = "msText";k.style.cssText = "color:#0f0;font-family:Helvetica,Arial,sans-serif;font-size:9px;font-weight:bold;line-height:15px";k.innerHTML = "MS";d.appendChild(k);var e = document.createElement("div");e.id = "msGraph";e.style.cssText = "position:relative;width:74px;height:30px;background-color:#0f0";for (d.appendChild(e); 74 > e.children.length;)j = document.createElement("span"), j.style.cssText = "width:1px;height:30px;float:left;background-color:#131", e.appendChild(j);var t = function(b) {s = b;switch (s) {case 0:a.style.display ="block";d.style.display = "none";break;case 1:a.style.display = "none", d.style.display = "block"}};return {REVISION: 11,domElement: f,setMode: t,begin: function() {l = Date.now()},end: function() {var b = Date.now();g = b - l;n = Math.min(n, g);o = Math.max(o, g);k.textContent = g + " MS (" + n + "-" + o + ")";var a = Math.min(30, 30 - 30 * (g / 200));e.appendChild(e.firstChild).style.height = a + "px";r++;b > m + 1E3 && (h = Math.round(1E3 * r / (b - m)), p = Math.min(p, h), q = Math.max(q, h), i.textContent = h + " FPS (" + p + "-" + q + ")", a = Math.min(30, 30 - 30 * (h / 100)), c.appendChild(c.firstChild).style.height =a + "px", m = b, r = 0);return b},update: function() {l = this.end()}}};



/*
 *
 * @author alteredq / http://alteredqualia.com/
 * @author mr.doob / http://mrdoob.com/
 */

var Detector = {canvas: !! window.CanvasRenderingContext2D,webgl: ( function () { try { var canvas = document.createElement( 'canvas' ); return !! window.WebGLRenderingContext && ( canvas.getContext( 'webgl' ) || canvas.getContext( 'experimental-webgl' ) ); } catch( e ) { return false; } } )(),workers: !! window.Worker,fileapi: window.File && window.FileReader && window.FileList && window.Blob,getWebGLErrorMessage: function () {var element = document.createElement( 'div' );element.id = 'webgl-error-message';element.style.fontFamily = 'monospace';element.style.fontSize = '13px';element.style.fontWeight = 'normal';element.style.textAlign = 'center';element.style.background = '#fff';element.style.color = '#000';element.style.padding = '1.5em';element.style.width = '400px';element.style.margin = '5em auto 0';if ( ! this.webgl ) {element.innerHTML = window.WebGLRenderingContext ? ['Your graphics card does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation" style="color:#000">WebGL</a>.<br />','Find out how to get it <a href="http://get.webgl.org/" style="color:#000">here</a>.'].join( '\n' ) : ['Your browser does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation" style="color:#000">WebGL</a>.<br/>','Find out how to get it <a href="http://get.webgl.org/" style="color:#000">here</a>.'].join( '\n' );}return element;},addGetWebGLMessage: function ( parameters ) {var parent, id, element;parameters = parameters || {};parent = parameters.parent !== undefined ? parameters.parent : document.body;id = parameters.id !== undefined ? parameters.id : 'oldie';element = Detector.getWebGLErrorMessage();element.id = id;parent.appendChild( element );}};



/*
 *
 * @author qiao / https://github.com/qiao
 * @author mrdoob / http://mrdoob.com
 * @author alteredq / http://alteredqualia.com/
 * @author WestLangley / http://github.com/WestLangley
 */

THREE.OrbitControls = function ( object, domElement ) {this.object = object;this.domElement = ( domElement !== undefined ) ? domElement : document;this.enabled = true;this.center = new THREE.Vector3();this.userZoom = true;this.userZoomSpeed = 1.0;this.userRotate = true;this.userRotateSpeed = 1.0;this.userPan = true;this.userPanSpeed = 2.0;this.autoRotate = false;this.autoRotateSpeed = 2.0; this.minPolarAngle = 0; this.maxPolarAngle = Math.PI;this.minDistance = 0;this.maxDistance = Infinity;this.keys = { LEFT: 37, UP: 38, RIGHT: 39, BOTTOM: 40, ROTATE: 65, ZOOM: 83, PAN: 68 };var scope = this;var EPS = 0.000001;var PIXELS_PER_ROUND = 1800;var rotateStart = new THREE.Vector2();var rotateEnd = new THREE.Vector2();var rotateDelta = new THREE.Vector2();var zoomStart = new THREE.Vector2();var zoomEnd = new THREE.Vector2();var zoomDelta = new THREE.Vector2();var phiDelta = 0;var thetaDelta = 0;var scale = 1;var lastPosition = new THREE.Vector3();var STATE = { NONE: -1, ROTATE: 0, ZOOM: 1, PAN: 2 };var state = STATE.NONE;var changeEvent = { type: 'change' };this.rotateLeft = function ( angle ) {if ( angle === undefined ) {angle = getAutoRotationAngle();}thetaDelta -= angle;};this.rotateRight = function ( angle ) {if ( angle === undefined ) {angle = getAutoRotationAngle();}thetaDelta += angle;};this.rotateUp = function ( angle ) {if ( angle === undefined ) {angle = getAutoRotationAngle();}phiDelta -= angle;};this.rotateDown = function ( angle ) {if ( angle === undefined ) {angle = getAutoRotationAngle();}phiDelta += angle;};this.zoomIn = function ( zoomScale ) {if ( zoomScale === undefined ) {zoomScale = getZoomScale();}scale /= zoomScale;};this.zoomOut = function ( zoomScale ) {if ( zoomScale === undefined ) {zoomScale = getZoomScale();}scale *= zoomScale;};this.pan = function ( distance ) {distance.transformDirection( this.object.matrix );distance.multiplyScalar( scope.userPanSpeed );this.object.position.add( distance );this.center.add( distance );};this.update = function () {var position = this.object.position;var offset = position.clone().sub( this.center );var theta = Math.atan2( offset.x, offset.z );var phi = Math.atan2( Math.sqrt( offset.x * offset.x + offset.z * offset.z ), offset.y );if ( this.autoRotate ) {this.rotateLeft( getAutoRotationAngle() );}theta += thetaDelta;phi += phiDelta;phi = Math.max( this.minPolarAngle, Math.min( this.maxPolarAngle, phi ) );phi = Math.max( EPS, Math.min( Math.PI - EPS, phi ) );var radius = offset.length() * scale;radius = Math.max( this.minDistance, Math.min( this.maxDistance, radius ) );offset.x = radius * Math.sin( phi ) * Math.sin( theta );offset.y = radius * Math.cos( phi );offset.z = radius * Math.sin( phi ) * Math.cos( theta );position.copy( this.center ).add( offset );this.object.lookAt( this.center );thetaDelta = 0;phiDelta = 0;scale = 1;if ( lastPosition.distanceTo( this.object.position ) > 0 ) {this.dispatchEvent( changeEvent );lastPosition.copy( this.object.position );}};function getAutoRotationAngle() {return 2 * Math.PI / 60 / 60 * scope.autoRotateSpeed;}function getZoomScale() {return Math.pow( 0.95, scope.userZoomSpeed );}function onMouseDown( event ) {if ( scope.enabled === false ) return;if ( scope.userRotate === false ) return;event.preventDefault();if ( state === STATE.NONE ){if ( event.button === 0 )state = STATE.ROTATE;if ( event.button === 1 )state = STATE.ZOOM;if ( event.button === 2 )state = STATE.PAN;}if ( state === STATE.ROTATE ) {rotateStart.set( event.clientX, event.clientY );} else if ( state === STATE.ZOOM ) {zoomStart.set( event.clientX, event.clientY );} else if ( state === STATE.PAN ) {}document.addEventListener( 'mousemove', onMouseMove, false );document.addEventListener( 'mouseup', onMouseUp, false );}function onMouseMove( event ) {if ( scope.enabled === false ) return;event.preventDefault();if ( state === STATE.ROTATE ) {rotateEnd.set( event.clientX, event.clientY );rotateDelta.subVectors( rotateEnd, rotateStart );scope.rotateLeft( 2 * Math.PI * rotateDelta.x / PIXELS_PER_ROUND * scope.userRotateSpeed );scope.rotateUp( 2 * Math.PI * rotateDelta.y / PIXELS_PER_ROUND * scope.userRotateSpeed );rotateStart.copy( rotateEnd );} else if ( state === STATE.ZOOM ) {zoomEnd.set( event.clientX, event.clientY );zoomDelta.subVectors( zoomEnd, zoomStart );if ( zoomDelta.y > 0 ) {scope.zoomIn();} else {scope.zoomOut();}zoomStart.copy( zoomEnd );} else if ( state === STATE.PAN ) {var movementX = event.movementX || event.mozMovementX || event.webkitMovementX || 0;var movementY = event.movementY || event.mozMovementY || event.webkitMovementY || 0;scope.pan( new THREE.Vector3( - movementX, movementY, 0 ) );}}function onMouseUp( event ) {if ( scope.enabled === false ) return;if ( scope.userRotate === false ) return;document.removeEventListener( 'mousemove', onMouseMove, false );document.removeEventListener( 'mouseup', onMouseUp, false );state = STATE.NONE;}function onMouseWheel( event ) {if ( scope.enabled === false ) return;if ( scope.userZoom === false ) return;var delta = 0;if ( event.wheelDelta ) { delta = event.wheelDelta;} else if ( event.detail ) { delta = - event.detail;}if ( delta > 0 ) {scope.zoomOut();} else {scope.zoomIn();}}function onKeyDown( event ) {if ( scope.enabled === false ) return;if ( scope.userPan === false ) return;switch ( event.keyCode ) {case scope.keys.ROTATE:state = STATE.ROTATE;break;case scope.keys.ZOOM:state = STATE.ZOOM;break;case scope.keys.PAN:state = STATE.PAN;break;}}function onKeyUp( event ) {switch ( event.keyCode ) {case scope.keys.ROTATE:case scope.keys.ZOOM:case scope.keys.PAN:state = STATE.NONE;break;}}this.domElement.addEventListener( 'contextmenu', function ( event ) { event.preventDefault(); }, false );this.domElement.addEventListener( 'mousedown', onMouseDown, false );this.domElement.addEventListener( 'mousewheel', onMouseWheel, false );this.domElement.addEventListener( 'DOMMouseScroll', onMouseWheel, false ); window.addEventListener( 'keydown', onKeyDown, false );window.addEventListener( 'keyup', onKeyUp, false );};THREE.OrbitControls.prototype = Object.create( THREE.EventDispatcher.prototype );



/*
 *
 * @author alteredq / http://alteredqualia.com/
 */

THREE.SceneUtils = {createMultiMaterialObject: function ( geometry, materials ) {var group = new THREE.Object3D();for ( var i = 0, l = materials.length; i < l; i ++ ) {group.add( new THREE.Mesh( geometry, materials[ i ] ) );}return group;},detach : function ( child, parent, scene ) {child.applyMatrix( parent.matrixWorld );parent.remove( child );scene.add( child );},attach: function ( child, scene, parent ) {var matrixWorldInverse = new THREE.Matrix4();matrixWorldInverse.getInverse( parent.matrixWorld );child.applyMatrix( matrixWorldInverse );scene.remove( child );parent.add( child );}};